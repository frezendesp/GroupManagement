{% extends "base.html" %}

{% block title %}Reports - Distribution Group Management{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Home</a></li>
<li class="breadcrumb-item active">Reports</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="h3 mb-4">
            <i class="bi bi-file-earmark-text me-2 text-primary"></i>
            Reports
        </h1>
    </div>
</div>

<!-- Report Types -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-transparent border-0 pb-0">
                <h5 class="card-title mb-0">
                    <i class="bi bi-collection me-2 text-primary"></i>
                    Group Membership Reports
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Generate detailed reports showing members of distribution groups, including contact information and organizational details.
                </p>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('main.group_membership_report') }}" class="btn btn-primary">
                        <i class="bi bi-file-earmark-pdf me-2"></i>
                        Generate Group Report
                    </a>
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#customGroupReportModal">
                        <i class="bi bi-sliders me-2"></i>
                        Custom Group Report
                    </button>
                </div>
                
                <hr class="my-4">
                
                <h6 class="text-muted mb-3">Quick Group Reports</h6>
                <div class="list-group list-group-flush">
                    <a href="{{ url_for('main.group_membership_report') }}?department=Human Resources" 
                       class="list-group-item list-group-item-action border-0 px-0">
                        <i class="bi bi-people me-2"></i>HR Department Groups
                    </a>
                    <a href="{{ url_for('main.group_membership_report') }}?department=General Practice" 
                       class="list-group-item list-group-item-action border-0 px-0">
                        <i class="bi bi-hospital me-2"></i>GP Department Groups
                    </a>
                    <a href="{{ url_for('main.group_membership_report') }}?department=Communications" 
                       class="list-group-item list-group-item-action border-0 px-0">
                        <i class="bi bi-megaphone me-2"></i>Communications Groups
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-transparent border-0 pb-0">
                <h5 class="card-title mb-0">
                    <i class="bi bi-people me-2 text-primary"></i>
                    User Reports
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Generate reports about users, their group memberships, contact information, and organizational structure.
                </p>
                
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userReportModal">
                        <i class="bi bi-file-earmark-spreadsheet me-2"></i>
                        Generate User Report
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="generateDirectoryReport()">
                        <i class="bi bi-telephone me-2"></i>
                        Phone Directory
                    </button>
                </div>
                
                <hr class="my-4">
                
                <h6 class="text-muted mb-3">Department Reports</h6>
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action border-0 px-0" onclick="generateDepartmentReport('Human Resources')">
                        <i class="bi bi-people me-2"></i>HR Department Users
                    </a>
                    <a href="#" class="list-group-item list-group-item-action border-0 px-0" onclick="generateDepartmentReport('General Practice')">
                        <i class="bi bi-hospital me-2"></i>GP Department Users
                    </a>
                    <a href="#" class="list-group-item list-group-item-action border-0 px-0" onclick="generateDepartmentReport('Communications')">
                        <i class="bi bi-megaphone me-2"></i>Communications Users
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Reports -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-transparent border-0 pb-0">
                <h5 class="card-title mb-0">
                    <i class="bi bi-activity me-2 text-primary"></i>
                    Activity Reports
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Track system usage, membership changes, and administrative activities with detailed audit reports.
                </p>
                
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#auditReportModal">
                        <i class="bi bi-shield-check me-2"></i>
                        Generate Audit Report
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="generateActivitySummary()">
                        <i class="bi bi-graph-up me-2"></i>
                        Activity Summary
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-transparent border-0 pb-0">
                <h5 class="card-title mb-0">
                    <i class="bi bi-calendar3 me-2 text-primary"></i>
                    Scheduled Reports
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Set up automated reports to be generated and delivered on a regular schedule.
                </p>
                
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#scheduleReportModal">
                        <i class="bi bi-plus-circle me-2"></i>
                        Schedule New Report
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="viewScheduledReports()">
                        <i class="bi bi-list-ul me-2"></i>
                        View Scheduled Reports
                    </button>
                </div>
                
                <hr class="my-4">
                
                <h6 class="text-muted mb-3">Active Schedules</h6>
                <div class="small text-muted">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Weekly Group Summary</span>
                        <span class="badge bg-success">Active</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Monthly Audit Report</span>
                        <span class="badge bg-success">Active</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Quarterly User Directory</span>
                        <span class="badge bg-warning">Paused</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Group Report Modal -->
<div class="modal fade" id="customGroupReportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Custom Group Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="customGroupReportForm">
                    <div class="mb-3">
                        <label for="reportTitle" class="form-label">Report Title</label>
                        <input type="text" class="form-control" id="reportTitle" value="Custom Group Membership Report">
                    </div>
                    
                    <div class="mb-3">
                        <label for="selectedGroups" class="form-label">Select Groups</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="selectAllGroups">
                            <label class="form-check-label" for="selectAllGroups">
                                <strong>Select All Groups</strong>
                            </label>
                        </div>
                        <hr>
                        <div style="max-height: 200px; overflow-y: auto;">
                            <!-- Groups would be dynamically loaded here -->
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="group1" name="groups" value="1">
                                <label class="form-check-label" for="group1">
                                    HR Management Team
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="group2" name="groups" value="2">
                                <label class="form-check-label" for="group2">
                                    GP Department Staff
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="group3" name="groups" value="3">
                                <label class="form-check-label" for="group3">
                                    Communications Team
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Include Information</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeContact" checked>
                            <label class="form-check-label" for="includeContact">
                                Contact Information (Email, Phone)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeOrg" checked>
                            <label class="form-check-label" for="includeOrg">
                                Organizational Information (Department, Role, Manager)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeLocation">
                            <label class="form-check-label" for="includeLocation">
                                Location Information
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="reportFormat" class="form-label">Report Format</label>
                        <select class="form-select" id="reportFormat">
                            <option value="pdf">PDF Document</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="csv">CSV File</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="generateCustomGroupReport()">
                    <i class="bi bi-download me-2"></i>Generate Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- User Report Modal -->
<div class="modal fade" id="userReportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate User Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="userReportForm">
                    <div class="mb-3">
                        <label for="userReportTitle" class="form-label">Report Title</label>
                        <input type="text" class="form-control" id="userReportTitle" value="User Directory Report">
                    </div>
                    
                    <div class="mb-3">
                        <label for="userDepartment" class="form-label">Filter by Department</label>
                        <select class="form-select" id="userDepartment">
                            <option value="">All Departments</option>
                            <option value="Human Resources">Human Resources</option>
                            <option value="General Practice">General Practice</option>
                            <option value="Communications">Communications</option>
                            <option value="IT">IT</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">User Status</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="userStatus" id="activeUsers" value="active" checked>
                            <label class="form-check-label" for="activeUsers">
                                Active Users Only
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="userStatus" id="allUsers" value="all">
                            <label class="form-check-label" for="allUsers">
                                All Users (Including Inactive)
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="userReportFormat" class="form-label">Report Format</label>
                        <select class="form-select" id="userReportFormat">
                            <option value="pdf">PDF Document</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="csv">CSV File</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="generateUserReport()">
                    <i class="bi bi-download me-2"></i>Generate Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Other modals would be similar... -->
{% endblock %}

{% block scripts %}
<script>
function generateCustomGroupReport() {
    // Collect form data
    const selectedGroups = [];
    document.querySelectorAll('input[name="groups"]:checked').forEach(function(checkbox) {
        selectedGroups.push(checkbox.value);
    });
    
    if (selectedGroups.length === 0) {
        alert('Please select at least one group.');
        return;
    }
    
    const format = document.getElementById('reportFormat').value;
    
    // In a real implementation, this would submit to the server
    alert(`Generating custom group report for ${selectedGroups.length} groups in ${format.toUpperCase()} format...`);
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('customGroupReportModal'));
    modal.hide();
}

function generateUserReport() {
    const department = document.getElementById('userDepartment').value;
    const status = document.querySelector('input[name="userStatus"]:checked').value;
    const format = document.getElementById('userReportFormat').value;
    
    // In a real implementation, this would submit to the server
    alert(`Generating user report for ${department || 'all departments'} (${status} users) in ${format.toUpperCase()} format...`);
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('userReportModal'));
    modal.hide();
}

function generateDirectoryReport() {
    alert('Generating phone directory report...');
}

function generateDepartmentReport(department) {
    alert(`Generating report for ${department} department...`);
}

function generateActivitySummary() {
    alert('Generating activity summary report...');
}

function viewScheduledReports() {
    alert('Displaying scheduled reports...');
}

// Handle select all groups checkbox
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('selectAllGroups');
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            const groupCheckboxes = document.querySelectorAll('input[name="groups"]');
            groupCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }
});
</script>
{% endblock %}
